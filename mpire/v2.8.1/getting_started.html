

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started &mdash; mpire 2.8.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="usage/index.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> mpire
          

          
          </a>

          
            
            
              <div class="version">
                2.8.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to the MPIRE documentation!</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage/index.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mpire</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Suppose you have a time consuming function that receives some input and returns its results. This could look like the
following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">time_consuming_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Simulate that this function takes long to complete</span>
    <span class="k">return</span> <span class="o">...</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_consuming_function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
<p>Running this function takes about 10 seconds to complete.</p>
<p>Functions like these are known as <a class="reference external" href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrassingly parallel</a> problems, functions that require little to no effort to
turn into a parallel task. Parallelizing a simple function as this can be as easy as importing <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> and
using the <code class="docutils literal notranslate"><span class="pre">multiprocessing.Pool</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_consuming_function</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>We configured to have 5 workers, so we can handle 5 tasks in parallel. As a result, this function will complete in about
2 seconds.</p>
<p>MPIRE can be used almost as a drop-in replacement to <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code>. We use the <a class="reference internal" href="reference/index.html#mpire.WorkerPool" title="mpire.WorkerPool"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mpire.WorkerPool</span></code></a> class and
call one of the available <code class="docutils literal notranslate"><span class="pre">map</span></code> functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpire</span> <span class="kn">import</span> <span class="n">WorkerPool</span>

<span class="k">with</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_consuming_function</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>Similarly, this will complete in about 2 seconds. The differences in code are small: there’s no need to learn a
completely new multiprocessing syntax, if you’re used to vanilla <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code>. The additional available
functionality, though, is what sets MPIRE apart.</p>
<section id="progress-bar">
<h2>Progress bar<a class="headerlink" href="#progress-bar" title="Permalink to this headline">¶</a></h2>
<p>Suppose we want to know the status of the current task: how many tasks are completed, how long before the work is ready?
It’s as simple as setting the <code class="docutils literal notranslate"><span class="pre">progress_bar</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_consuming_function</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>And it will output a nicely formatted <a class="reference external" href="https://tqdm.github.io/">tqdm</a> progress bar.</p>
<p>MPIRE also offers a dashboard, for which you need to install additional <a class="reference internal" href="install.html#dashboarddep"><span class="std std-ref">dependencies</span></a>. See
<a class="reference internal" href="usage/dashboard.html#dashboard"><span class="std std-ref">Dashboard</span></a> for more information.</p>
</section>
<section id="shared-objects">
<h2>Shared objects<a class="headerlink" href="#shared-objects" title="Permalink to this headline">¶</a></h2>
<p>If you have one or more objects that you want to share between all workers you can make use of the copy-on-write
<code class="docutils literal notranslate"><span class="pre">shared_objects</span></code> option of MPIRE. MPIRE will pass on these objects only once for each worker without
copying/serialization. Only when the object is altered in the worker function it will start copying it for that worker.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Copy-on-write is not available on Windows, as it requires the start method <code class="docutils literal notranslate"><span class="pre">fork</span></code>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">time_consuming_function</span><span class="p">(</span><span class="n">some_object</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Simulate that this function takes long to complete</span>
    <span class="k">return</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">some_object</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">with</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shared_objects</span><span class="o">=</span><span class="n">some_object</span><span class="p">,</span> <span class="n">start_method</span><span class="o">=</span><span class="s1">&#39;fork&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_consuming_function</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="usage/workerpool/shared_objects.html#shared-objects"><span class="std std-ref">Shared objects</span></a> for more details.</p>
</section>
<section id="worker-initialization">
<h2>Worker initialization<a class="headerlink" href="#worker-initialization" title="Permalink to this headline">¶</a></h2>
<p>Need to initialize each worker before starting the work? Have a look at the <code class="docutils literal notranslate"><span class="pre">worker_state</span></code> and <code class="docutils literal notranslate"><span class="pre">worker_init</span></code>
functionality:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">worker_state</span><span class="p">):</span>
    <span class="c1"># Load a big dataset or model and store it in a worker specific worker_state</span>
    <span class="n">worker_state</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">worker_state</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">worker_state</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="c1"># Let the model predict a specific instance of the dataset</span>
    <span class="k">return</span> <span class="n">worker_state</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">worker_state</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>

<span class="k">with</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">use_worker_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">worker_init</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly, you can use the <code class="docutils literal notranslate"><span class="pre">worker_exit</span></code> parameter to let MPIRE call a function whenever a worker terminates. You can
even let this exit function return results, which can be obtained later on. See the <a class="reference internal" href="usage/map/worker_init_exit.html#worker-init-exit"><span class="std std-ref">Worker init and exit</span></a> section for
more information.</p>
</section>
<section id="worker-insights">
<h2>Worker insights<a class="headerlink" href="#worker-insights" title="Permalink to this headline">¶</a></h2>
<p>When your multiprocessing setup isn’t performing as you want it to and you have no clue what’s causing it, there’s the
worker insights functionality. This will give you some insight in your setup, but it will not profile the function
you’re running (there are other libraries for that). Instead, it profiles the worker start up time, waiting time and
working time. When worker init and exit functions are provided it will time those as well.</p>
<p>Perhaps you’re sending a lot of data over the task queue, which makes the waiting time go up. Whatever the case, you
can enable and grab the insights using the <code class="docutils literal notranslate"><span class="pre">enable_insights</span></code> flag and <a class="reference internal" href="reference/index.html#mpire.WorkerPool.get_insights" title="mpire.WorkerPool.get_insights"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mpire.WorkerPool.get_insights()</span></code></a> function,
respectively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">enable_insights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_consuming_function</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">insights</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_insights</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="usage/workerpool/worker_insights.html#worker-insights"><span class="std std-ref">Worker insights</span></a> for a more detailed example and expected output.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage/index.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2024, Sybren Jansen

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v2.8.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../v1.1.2/index.html">v1.1.2</a></dd>
            <dd><a href="../v1.1.3/index.html">v1.1.3</a></dd>
            <dd><a href="../v1.2.0/index.html">v1.2.0</a></dd>
            <dd><a href="../v1.2.1/index.html">v1.2.1</a></dd>
            <dd><a href="../v1.2.2/index.html">v1.2.2</a></dd>
            <dd><a href="../v2.0.0/getting_started.html">v2.0.0</a></dd>
            <dd><a href="../v2.1.0/getting_started.html">v2.1.0</a></dd>
            <dd><a href="../v2.1.1/getting_started.html">v2.1.1</a></dd>
            <dd><a href="../v2.10.0/getting_started.html">v2.10.0</a></dd>
            <dd><a href="../v2.10.1/getting_started.html">v2.10.1</a></dd>
            <dd><a href="../v2.10.2/getting_started.html">v2.10.2</a></dd>
            <dd><a href="../v2.2.0/getting_started.html">v2.2.0</a></dd>
            <dd><a href="../v2.2.1/getting_started.html">v2.2.1</a></dd>
            <dd><a href="../v2.3.0/getting_started.html">v2.3.0</a></dd>
            <dd><a href="../v2.3.1/getting_started.html">v2.3.1</a></dd>
            <dd><a href="../v2.3.2/getting_started.html">v2.3.2</a></dd>
            <dd><a href="../v2.3.3/getting_started.html">v2.3.3</a></dd>
            <dd><a href="../v2.3.4/getting_started.html">v2.3.4</a></dd>
            <dd><a href="../v2.3.5/getting_started.html">v2.3.5</a></dd>
            <dd><a href="../v2.4.0/getting_started.html">v2.4.0</a></dd>
            <dd><a href="../v2.5.0/getting_started.html">v2.5.0</a></dd>
            <dd><a href="../v2.6.0/getting_started.html">v2.6.0</a></dd>
            <dd><a href="../v2.7.0/getting_started.html">v2.7.0</a></dd>
            <dd><a href="../v2.7.1/getting_started.html">v2.7.1</a></dd>
            <dd><a href="../v2.8.0/getting_started.html">v2.8.0</a></dd>
            <dd><a href="getting_started.html">v2.8.1</a></dd>
            <dd><a href="../v2.9.0/getting_started.html">v2.9.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../master/getting_started.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>