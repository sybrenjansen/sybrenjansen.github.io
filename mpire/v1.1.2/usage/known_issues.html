

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Known issues &mdash; mpire 1.1.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../reference/index.html" />
    <link rel="prev" title="Dashboard" href="dashboard.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> mpire
          

          
          </a>

          
            
            
              <div class="version">
                1.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to the MPIRE documentation!</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="map.html">Map family</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Known issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mpire</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Usage</a> &raquo;</li>
        
      <li>Known issues</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/usage/known_issues.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="known-issues">
<h1>Known issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h1>
<p>This section describes the known issues in MPIRE.</p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#unit-tests" id="id1">Unit tests</a></p></li>
<li><p><a class="reference internal" href="#unpicklable-tasks-results" id="id2">Unpicklable tasks/results</a></p></li>
</ul>
</div>
<section id="unit-tests">
<h2><a class="toc-backref" href="#id1">Unit tests</a><a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>When using the <code class="docutils literal notranslate"><span class="pre">'spawn'</span></code> or <code class="docutils literal notranslate"><span class="pre">'forkserver'</span></code> method you’ll probably run in to one or two issues when running
unittests in your own package. One problem that might occur is that your unittests will restart whenever the piece of
code containing such a start method is called, leading to very funky terminal output. To remedy this problem make sure
your <code class="docutils literal notranslate"><span class="pre">setup</span></code> call in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is surrounded by an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> clause:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c1"># Call setup and install any dependencies you have inside the if-clause</span>
    <span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>See the ‘Safe importing of main module’ section at <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#the-spawn-and-forkserver-start-methods">caveats</a>.</p>
<p>The second problem you might encounter is that the semaphore tracker of multiprocessing will complain when you run
individual (or a selection of) unittests using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">test</span> <span class="pre">-s</span> <span class="pre">tests.some_test</span></code>. At the end of the tests you
will see errors like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;.../site-packages/multiprocess/semaphore_tracker.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">132</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="ne">KeyError</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;/mp-d3i13qd5&#39;</span>
<span class="o">.../</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">multiprocess</span><span class="o">/</span><span class="n">semaphore_tracker</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">146</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">semaphore_tracker</span><span class="p">:</span> <span class="n">There</span> <span class="n">appear</span> <span class="n">to</span> <span class="n">be</span> <span class="mi">58</span>
                                                         <span class="n">leaked</span> <span class="n">semaphores</span> <span class="n">to</span> <span class="n">clean</span> <span class="n">up</span> <span class="n">at</span> <span class="n">shutdown</span>
  <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
<span class="o">.../</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">multiprocess</span><span class="o">/</span><span class="n">semaphore_tracker</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">158</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">semaphore_tracker</span><span class="p">:</span> <span class="s1">&#39;/mp-f45dt4d6&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span>
                                                         <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;semaphore_tracker: </span><span class="si">%r</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Your unittests will still succeed and run OK. Unfortunately, I’ve not found a remedy to this problem using
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">test</span></code> yet. What you can use instead is something like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">tests</span><span class="o">.</span><span class="n">some_test</span>
</pre></div>
</div>
<p>This will work just fine. See the <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#command-line-interface">unittest</a> documentation for more information.</p>
</section>
<section id="unpicklable-tasks-results">
<h2><a class="toc-backref" href="#id2">Unpicklable tasks/results</a><a class="headerlink" href="#unpicklable-tasks-results" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you can encounter deadlocks in your code when using MPIRE. When you encounter this, it could well be that some
tasks or results from your script can’t be pickled. MPIRE makes use of multiprocessing queues for inter-process
communication and if your function returns unpicklable results the queue will unfortunately deadlock.</p>
<p>The only way I could remedy this problem in MPIRE would be to manually pickle objects before sending it to a queue and
quit gracefully when encountering a pickle error. However, this would mean objects would always be pickled twice. This
would add a heavy performance penalty and is therefore not an acceptable solution. Instead, the user should make sure
their tasks and results are always picklable (which in most cases won’t be a problem).</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../reference/index.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dashboard.html" class="btn btn-neutral float-left" title="Dashboard" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2023, Sybren Jansen

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v1.1.2
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="known_issues.html">v1.1.2</a></dd>
            <dd><a href="../../v1.1.3/usage/known_issues.html">v1.1.3</a></dd>
            <dd><a href="../../v1.2.0/usage/known_issues.html">v1.2.0</a></dd>
            <dd><a href="../../v1.2.1/usage/known_issues.html">v1.2.1</a></dd>
            <dd><a href="../../v1.2.2/usage/known_issues.html">v1.2.2</a></dd>
            <dd><a href="../../v2.0.0/index.html">v2.0.0</a></dd>
            <dd><a href="../../v2.1.0/index.html">v2.1.0</a></dd>
            <dd><a href="../../v2.1.1/index.html">v2.1.1</a></dd>
            <dd><a href="../../v2.2.0/index.html">v2.2.0</a></dd>
            <dd><a href="../../v2.2.1/index.html">v2.2.1</a></dd>
            <dd><a href="../../v2.3.0/index.html">v2.3.0</a></dd>
            <dd><a href="../../v2.3.1/index.html">v2.3.1</a></dd>
            <dd><a href="../../v2.3.2/index.html">v2.3.2</a></dd>
            <dd><a href="../../v2.3.3/index.html">v2.3.3</a></dd>
            <dd><a href="../../v2.3.4/index.html">v2.3.4</a></dd>
            <dd><a href="../../v2.3.5/index.html">v2.3.5</a></dd>
            <dd><a href="../../v2.4.0/index.html">v2.4.0</a></dd>
            <dd><a href="../../v2.5.0/index.html">v2.5.0</a></dd>
            <dd><a href="../../v2.6.0/index.html">v2.6.0</a></dd>
            <dd><a href="../../v2.7.0/index.html">v2.7.0</a></dd>
            <dd><a href="../../v2.7.1/index.html">v2.7.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../master/index.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>